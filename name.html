<script>
    // ثبت Service Worker و اطمینان از کش شدن منابع قبل از ریدایرکت
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js').then(function(registration) {
            console.log('Service Worker registered with scope:', registration.scope);
            
            // باز کردن و کش کردن منابع
            caches.open('offline-cache-v1').then(function(cache) {
                return cache.addAll([
                    '/offline-page.html', // صفحه آفلاین
                    '/wifi.png',          // آیکون قطع اینترنت
                    'https://fonts.googleapis.com/css?family=Roboto' // فونت ضروری
                ]);
            }).then(function() {
                console.log('Resources cached successfully.');

                // اطمینان از این‌که منابع کش شده‌اند
                caches.match('/offline-page.html').then(function(response) {
                    if (response) {
                        // اگر منابع کش شدند، ریدایرکت انجام می‌شود
                        window.location.href = 'https://imoviee.com';
                    } else {
                        document.body.innerHTML = '<h1>خطا: صفحه آفلاین کش نشد. لطفاً دوباره تلاش کنید.</h1>';
                    }
                });
            }).catch(function(error) {
                document.body.innerHTML = '<h1>خطا در کش کردن منابع.</h1>';
                console.error(error);
            });
        }).catch(function(error) {
            document.body.innerHTML = '<h1>خطا: ثبت Service Worker شکست خورد.</h1>';
            console.error(error);
        });
    } else {
        document.body.innerHTML = '<h1>مرورگر شما از Service Worker پشتیبانی نمی‌کند.</h1>';
    }
</script>
